<VirtualHost *:80>
	ServerName	mitgliederverwaltung.on-i.de
	ServerAlias	mitgliederverwaltung.opennet-initiative.de
	# Umleitung fuer alles bis auf letsencrypt
	RedirectMatch permanent ^/((?!\.well-known/acme-challenge/).*)$ https://mitgliederverwaltung.opennet-initiative.de/$1
</VirtualHost>

<VirtualHost *:443>
	ServerName	mitgliederverwaltung.on-i.de
	ServerAlias	mitgliederverwaltung.opennet-initiative.de
	DocumentRoot	/var/www/mitgliederverwaltung/
	Alias		/moin_static{{ moinmoin_version }}/applets/FCKeditor/	/usr/share/fckeditor/
	Alias		/moin_static{{ moinmoin_version }}/			/usr/share/moin/htdocs/
	ScriptAlias	/					/usr/share/moin/server/moin.cgi/

	# siehe https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=782525
	# sonst gibt es Fehler beim Besuchen von Wiki-Seiten mit Umlauten (z.B. AktuelleAenderungen)
	SetEnv LANG C.UTF-8

	SSLEngine on
	SSLCertificateFile /var/lib/dehydrated/certs/mitgliederverwaltung.opennet-initiative.de/fullchain.pem
	SSLCertificateKeyFile /var/lib/dehydrated/certs/mitgliederverwaltung.opennet-initiative.de/privkey.pem

	<Location />
		AuthType		basic
		AuthName		"Opennet Mitgliederverwaltung"
		AuthBasicProvider	file
		AuthUserFile		/etc/apache2/wiki-mitgliederverwaltung.htpasswd
		Require			valid-user
	</Location>

	# TODO: die Client-Authorisation scheint (aus Sicht des Browsers) nur vertrauensw√ºrdig zu sein,
	#	wenn das Server-Zertifikat von derselbe CA unterschrieben wurde, wie das vom Browser
	#	praesentierte Zertifikat.
	# Authorisation via SSL-Client-Zertifikat
	#SSLCACertificateFile /usr/share/ca-certificates/opennet-initiative.de/opennet-client.crt
	#SSLCADNRequestFile /usr/share/ca-certificates/opennet-initiative.de/opennet-client.crt
	#SSLCARevocationFile /etc/ssl/crl/opennet-client.crl
	#SSLCARevocationCheck leaf
	#SSLVerifyClient optional
	#SSLVerifyDepth 3
	#SSLUserName SSL_CLIENT_S_DN_CN
	#<Location />
	#	SSLRequire %{SSL_CLIENT_S_DN_CN} in {"martingarbe.client.on","larskruse.client.on"}
	#	ErrorDocument 403 "Only specific users with a certificate issued by Opennet Client Sub-CA may access this site."
	#</Location>

	LogLevel warn
	ErrorLog ${APACHE_LOG_DIR}/wiki-mitgliederverwaltung-error.log
	CustomLog ${APACHE_LOG_DIR}/wiki-mitgliederverwaltung-access.log combined
</VirtualHost>
