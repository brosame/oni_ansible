- name: buildbot - Software installieren
  apt:
    name: buildbot-worker
    install_recommends: no

- name: buildbot - Konfiguration erstellen
  command: "buildbot create-slave {{ opennetdev_slave_buildbot_path }}/{{ opennetdev_name }} {{ opennetdev_name }}.opennet-initiative.de {{ opennetdev_name }} {{ opennetdev_slave_buildbot_pass }}"
  args:
    creates: "{{ opennetdev_slave_buildbot_path }}/{{ opennetdev_name }}/buildbot.tac"
  notify: restart buildslave

- name: buildbot - Hostnamen setzen
  copy:
    content: "{{ opennetdev_slave_buildbot_host }}"
    dest: "{{ opennetdev_slave_buildbot_path }}/{{ opennetdev_name }}/info/host"
  notify:  restart buildslave

- name: buildbot - Admin Kontakt setzen
  copy:
    content: "{{ opennetdev_slave_buildbot_admin }}"
    dest: "{{ opennetdev_slave_buildbot_path }}/{{ opennetdev_name }}/info/admin"
  notify:  restart buildslave

- name: buildbot - Dienst aktivieren
  lineinfile:
    dest: "/etc/default/buildslave"
    backrefs: yes
    regexp: "SLAVE_ENABLED[1]"
    line: "SLAVE_ENABLED[1]=1"
  notify: restart buildslave
